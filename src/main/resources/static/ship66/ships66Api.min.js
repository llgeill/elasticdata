!function(t) {
    var e = {};
    function i(n) {
        if (e[n])
            return e[n].exports;
        var r = e[n] = {
            i: n,
            l: !1,
            exports: {}
        };
        return t[n].call(r.exports, r, r.exports, i),
        r.l = !0,
        r.exports
    }
    i.m = t,
    i.c = e,
    i.d = function(t, e, n) {
        i.o(t, e) || Object.defineProperty(t, e, {
            enumerable: !0,
            get: n
        })
    }
    ,
    i.r = function(t) {
        "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, {
            value: "Module"
        }),
        Object.defineProperty(t, "__esModule", {
            value: !0
        })
    }
    ,
    i.t = function(t, e) {
        if (1 & e && (t = i(t)),
        8 & e)
            return t;
        if (4 & e && "object" == typeof t && t && t.__esModule)
            return t;
        var n = Object.create(null);
        if (i.r(n),
        Object.defineProperty(n, "default", {
            enumerable: !0,
            value: t
        }),
        2 & e && "string" != typeof t)
            for (var r in t)
                i.d(n, r, function(e) {
                    return t[e]
                }
                .bind(null, r));
        return n
    }
    ,
    i.n = function(t) {
        var e = t && t.__esModule ? function() {
            return t.default
        }
        : function() {
            return t
        }
        ;
        return i.d(e, "a", e),
        e
    }
    ,
    i.o = function(t, e) {
        return Object.prototype.hasOwnProperty.call(t, e)
    }
    ,
    i.p = "",
    i(i.s = 8)
}([function(t, e, i) {
    i(3),
    i(9),
    i(10),
    function(t) {
        function e(t, e) {
            var i = Math.cos(e)
              , n = Math.sin(e)
              , r = t[0] * i - t[1] * n
              , o = t[1] * i + t[0] * n;
            return t[0] = r,
            t[1] = o,
            t
        }
        function i(t, e) {
            return t[0] *= e,
            t[1] *= e,
            t
        }
        function n(t, e) {
            var i = t[0].style.transform.replace("matrix(", "").replace(")", "").split(",");
            i[4] = -e[0],
            i[5] = e[1],
            t[0].style.transform = function(t) {
                return "matrix(" + t.join(",") + ")"
            }(i)
        }
        function r(t) {
            return 1 - function(t) {
                return Math.pow(t, 3)
            }(1 - t)
        }
        ol.interaction.DragPan.prototype.handleDragEvent = function(t) {
            var r = function(t) {
                var e = t.length;
                let i = 0
                  , n = 0;
                for (let r = 0; r < e; r++)
                    i += t[r].clientX,
                    n += t[r].clientY;
                return [i / e, n / e]
            }(this.targetPointers);
            if (this.panning_ || (this.panning_ = !0,
            this.lastCentroid = r,
            this.getMap().getView().beginInteraction()),
            this.getMap().isMoving = 1 == this.lastPointersCount_,
            1 == this.lastPointersCount_ && this.targetPointers.length == this.lastPointersCount_) {
                if (this.kinetic_ && this.kinetic_.update(r[0], r[1]),
                this.lastCentroid) {
                    var o = [this.lastCentroid[0] - r[0], r[1] - this.lastCentroid[1]]
                      , s = t.map
                      , a = s.getView();
                    if (s.noRenderOnMoving) {
                        for (var l = 0; l < s.renderer_.children_.length; l++)
                            n($($("canvas", s.renderer_.children_[l])), o);
                        this.lastPoint = r
                    } else
                        i(o, a.getResolution()),
                        e(o, a.getRotation()),
                        a.adjustCenterInternal(o),
                        this.lastCentroid = r
                }
            } else
                this.kinetic_ && this.kinetic_.begin();
            this.lastPointersCount_ = this.targetPointers.length,
            t.originalEvent.preventDefault()
        }
        ,
        ol.interaction.DragPan.prototype.handleUpEvent = function(t) {
            var o = t.map
              , s = o.getView();
            if (0 === this.targetPointers.length) {
                if (this.panning_) {
                    if (this.panning_ = !1,
                    o.noRenderOnMoving && this.lastCentroid && this.lastPoint) {
                        var a = this.lastPoint
                          , l = [this.lastCentroid[0] - a[0], a[1] - this.lastCentroid[1]];
                        i(l, s.getResolution()),
                        e(l, s.getRotation());
                        for (var h = 0; h < o.renderer_.children_.length; h++)
                            n($($("canvas", o.renderer_.children_[h])), [0, 0]);
                        this.getMap().isMoving = !1,
                        s.adjustCenterInternal(l),
                        this.lastCentroid = a
                    }
                    s.endInteraction()
                }
                if (!this.noKinetic_ && this.kinetic_ && this.kinetic_.end()) {
                    var t = this.kinetic_.getDistance()
                      , e = this.kinetic_.getAngle()
                      , i = s.getCenterInternal()
                      , n = o.getPixelFromCoordinateInternal(i)
                      , a = o.getCoordinateFromPixelInternal([n[0] - t * Math.cos(e), n[1] - t * Math.sin(e)]);
                    s.animateInternal({
                        center: s.getConstrainedCenter(a),
                        duration: 500,
                        easing: r
                    })
                }
                return !1
            }
            return this.kinetic_ && this.kinetic_.begin(),
            this.lastCentroid = null,
            !0
        }
        ,
        ol.View.prototype.adjustResolutionInternal = function(t, e) {
            var i = this.getAnimating() || this.getInteracting()
              , n = this.getViewportSize_(this.getRotation())
              , r = this.constraints_.resolution(this.targetResolution_ * t, 0, n, i);
            r < this.minResolution_ && (r = this.minResolution_),
            r > this.maxResolution_ && (r = this.maxResolution_),
            this.targetResolution_ = r,
            e && (this.targetCenter_ = this.calculateCenterZoom(r, e)),
            this.applyTargetState_()
        }
        ;
        var o, s = {
            sources: {
                MT_GOOGLE: "https://mt2.google.cn/vt?lyrs=m@180000000&hl=zh-CN&gl=CN&s=Gal&x={x}&y={y}&z={z}",
                MT_GOOGLESAT: "https://www.google.cn/maps/vt?lyrs=s@802&gl=cn&x={x}&y={y}&z={z}"
            },
            support: {
                SHIPS66_SHIP: "https://g3.ships66.com/{z}/{z}/{x}-{y}.png"
            },
            controls: {},
            theme: {},
            renderers: {},
            version: "",
            author: "",
            email: "",
            datas: {},
            plugins: {
                init: function() {}
            },
            utils: {
                gzip: function(t) {
                    //base64解密  切割成一个个字符   返回Unicode 编码的数组
                    var e, i = atob(t).split("").map((function(t) {
                        return t.charCodeAt(0)
                    }
                    )), n = new Uint8Array(i), r = pako.inflate(n), o = "";
                    for (e = 0; e < r.length / 8192; e++)
                        o += String.fromCharCode.apply(null, r.slice(8192 * e, 8192 * (e + 1)));
                    return o += String.fromCharCode.apply(null, r.slice(8192 * e)),
                    decodeURIComponent(escape(o))
                }
            },
            format: new ol.format.WKT,
            layers: {},
            telephone: "",
            isIdle: !0,
            codingCoordinate: !0,
            mecaterHalfWidth: 20037508.342789244,
            extends: (o = function(t, e) {
                return (o = Object.setPrototypeOf || {
                    __proto__: []
                }instanceof Array && function(t, e) {
                    t.__proto__ = e
                }
                || function(t, e) {
                    for (var i in e)
                        e.hasOwnProperty(i) && (t[i] = e[i])
                }
                )(t, e)
            }
            ,
            function(t, e) {
                function i() {
                    this.constructor = t
                }
                o(t, e),
                t.prototype = null === e ? Object.create(e) : (i.prototype = e.prototype,
                new i)
            }
            ),
            loadSupports: function(t, e, i, n) {
                for (var r = {}, o = 0; o < t.length; o++) {
                    var s = t[o]
                      , a = this.support[s]
                      , l = extend({
                        name: s,
                        zIndex: (i || 0) + o
                    }, e)
                      , h = extend({}, n);
                    r[s] = this.loadTileSetting(a, l, h)
                }
                return r
            },
            changeSource: function(t, e, i) {
                for (var n = t.getLayers().getArray(), r = 0; r < n.length; r++)
                    if (n[r].get("name") == e) {
                        var o = n[r].get("urls")[i];
                        if (null == o)
                            o = i;
                        else {
                            var a = n[r].get("noParseCoordinate").indexOf(i) < 0;
                            if (a != s.codingCoordinate) {
                                s.codingCoordinate = a;
                                for (var l = 0; l < n.length; l++)
                                    n[l].changeCoding && n[l].changeCoding(a)
                            }
                        }
                        return "string" == typeof o ? n[r].getSource().setUrl(o) : n[r].getSource().setUrls(o.urls),
                        n[r]
                    }
            },
            // setCookie(t, e, i) {
            //     var n = new Date;
            //     i ? n.setTime(n.getTime() + 1e3 * i) : n.setTime(n.getTime() + 2592e6),
            //     document.cookie = escape(t) + "=" + encodeURIComponent(escape(e)) + ";path=/;expires=" + n.toGMTString()
            // },
            loadSources: function(t, e) {
                var i, n, r = {};
                !this.sources[e.default] && t.indexOf(e.default) < 0 && (e.default = t[0],
                s.setCookie("_elane_maptype", e.default));
                for (var o = 0; o < t.length; o++) {
                    var a = t[o];
                    0 == o && (n = a,
                    this.sources[e.default] && (n = e.default),
                    i = this.sources[n]),
                    r[a] = this.sources[a]
                }
                var l = extend({
                    noParseCoordinate: ["MT_OSM", "MT_CNMAP"],
                    name: "basemap"
                }, e, {
                    urls: r
                });
                return s.codingCoordinate = l.noParseCoordinate.indexOf(n) < 0,
                this.loadTileSetting(i, l, "string" == typeof i ? null : i)
            },
            loadTileSetting: function(t, e, i) {
                var n = getParams("string" == typeof t ? t : t.urls[0])
                  , r = 1;
                n.scale && (r = n.scale);
                var o = extend({
                    urls: "string" == typeof t ? [t] : t.urls,
                    tilePixelRatio: r
                }, i)
                  , s = new ol.source.XYZ(o);
                return extend({}, {
                    minZoom: 2,
                    maxZoom: 18,
                    minZ: 2,
                    maxZ: 18
                }, {
                    source: s
                }, e)
            },
            getOtherLayer: function(t, e) {
                for (var i = t.getLayers().getArray(), n = 0; n < i.length; n++)
                    if (i[n].get("name") == e)
                        return i[n];
                return null
            },
            wrapLonLat: function(t) {
                return this.wrapCoordinate(t, "EPSG:4326")
            },
            wrapProjection: function(t) {
                return this.wrapCoordinate(t, "EPSG:3857")
            },
            wrapCoordinate: function(t, e) {
                return null == e || e.indexOf("4326") >= 0 ? this.toLonLat(this.fromLonLat(t)) : this.fromLonLat(this.toLonLat(t))
            },
            wrapCoordinates: function(t, e) {
                for (var i = [], n = 0; n < t.length; n++)
                    "object" == typeof t[n][0] ? i[n] = this.wrapCoordinates(t[n], e) : i[n] = this.wrapCoordinate(t[n], e);
                return i
            },
            wrapGeometry: function(t, e) {
                var i = t.getCoordinates()
                  , n = [];
                return n = "object" == typeof i[0] ? this.wrapCoordinates(i, e) : this.wrapCoordinate(i, e),
                t.setCoordinates(n),
                t
            },
            wrapExtent: function(t, e) {
                for (var i = [], n = 0; n < t.length; n += 2) {
                    var r = this.wrapCoordinate([t[n], t[n + 1]], e);
                    i[n] = r[0],
                    i[n + 1] = r[1]
                }
                return i
            },
            getWrapExtent: function(t) {
                return this.wrapExtent(t.getView().calculateExtent(), t.getView().getProjection().getCode())
            },
            LatLngInRegion: function(t, e) {
                return !(!t || !e) && e.containsXY(t[0], t[1])
            },
            decodeCoordinate: function(t, e) {
                if (this.codingCoordinate && this.LatLngInRegion(t, e))
                    return GPS.gcj_decrypt(t);
                return t
            },
            encodeCoordinate: function(t, e) {
                if (this.codingCoordinate && this.LatLngInRegion(t, e))
                    return GPS.gcj_encrypt(t);
                return t
            },
            judgeShipDirect: function(t, e, i) {
                var n = "";
                return t && 1 * t > 1 && (n = null != e && 1 * e != 511 && null != i ? 1 * i - 1 * e >= 3 ? "left" : 1 * i - 1 * e <= -3 ? "right" : "front" : "front"),
                n
            },
            addCNMap: function(t, e) {
                if (e.map)
                    for (var i = map.getLayers().getArray(), n = 0; n < i.length; n++)
                        "MT_CNMAP" == i[n].get("name") && e.map.removeLayer(i[n]);
                var r = extend({}, {
                    minZoom: 5,
                    maxZoom: 15,
                    visible: !1
                }, e);
                delete r.map,
                s.support.MT_CNMAP = "http://101.230.249.90:7002/OneMapServer/rest/services/globe_seamap/MapServer/tile/{z}/{y}/{x}?scale=2&token=" + t;
                var o = s.loadSupports(["MT_CNMAP"], r, 1)
                  , a = new ol.layer.Tile(o.MT_CNMAP);
                null == r.map && map.addLayer(a)
            },
            getShipAngle: function(t) {
                return t.speed && t.speed > 1 && t.speed < 102.3 || null == t.hdg || 511 == t.hdg || 0 == t.hdg ? t.cog ? t.cog : 0 : t.hdg
            },
            getLayersInfo: function(e) {
                for (var i = t.map.getLayers().array_, n = 0; n < i.length; n++) {
                    if (e == i[n].values_.name)
                        return i[n]
                }
                return null
            },
            getServerData: function(t) {
                "/ais/getAisInfo" == t.url && params.dev && t.url;
                var e = extend({}, t, {
                    success: function(t) {
                        if (t.data && ("string" == typeof t.data ? t.data = JSON.parse(s.utils.gzip(t.data)) : "string" == typeof t.data[0] && (t.data = JSON.parse(s.utils.gzip(t.data[0]))),
                        null == t.result && (t.result = !0)),
                        e.keymap && t.map) {
                            for (var i = [], n = 0; n < t.data.length; n++) {
                                for (var r = {}, o = 0; o < t.map.length; o++) {
                                    var a = e.keymap[t.map[o]];
                                    a ? r[a] = t.data[n][o] : r[t.map[o]] = t.data[n][o]
                                }
                                i.push(r)
                            }
                            delete t.map,
                            t.data = i
                        }
                        e.successCallback && e.successCallback(t)
                    },
                    error: function(t) {
                        "abort" != t.statusText && (debug("出错了", t),
                        e.errorCallback && e.errorCallback(t))
                    }
                });
            },
            extentToRing: function(t, e) {
                return 0 == e ? [ol.extent.getBottomLeft(t), ol.extent.getBottomRight(t), ol.extent.getTopRight(t), ol.extent.getTopLeft(t)] : [ol.extent.getBottomLeft(t), ol.extent.getTopLeft(t), ol.extent.getTopRight(t), ol.extent.getBottomRight(t)]
            },
            combineExtent: function(t, e) {
                if (e && ol.extent.equals(t, e))
                    return null;
                if (!e || !ol.extent.intersects(t, e))
                    return ol.geom.Polygon.fromExtent(t);
                if (ol.extent.containsExtent(t, e))
                    return new ol.geom.Polygon([ol.geom.Polygon.fromExtent(t).getCoordinates()[0], ol.geom.Polygon.fromExtent(e).getCoordinates()[0]]);
                if (ol.extent.containsExtent(e, t))
                    return null;
                for (var i = ol.extent.getIntersection(t, e), n = new Ring(s.extentToRing(i)), r = [], o = new Ring(s.extentToRing(t)), a = o.data.length - 1; a >= 0; a--)
                    ol.extent.containsCoordinate(i, o.data[a]) && r.push(a);
                switch (r.length) {
                case 1:
                    var l = o.data[r[0]]
                      , h = n.data[r[0] + 2] || n.data[r[0] - 2];
                    if (1 == r[0] || 3 == r[0])
                        o.data.splice(r[0], 1, [l[0], h[1]], h, [h[0], l[1]]);
                    else
                        try {
                            o.data.splice(r[0], 1, [h[0], l[1]], h, [l[0], h[1]])
                        } catch (t) {
                            debug().error("出错了", o, n, r, l, h, t)
                        }
                    return o.closeRing(),
                    new ol.geom.Polygon([o.data]);
                case 2:
                    return o.data.splice(r[0], 1, n.data[(r[0] - 1 + 4) % 4]),
                    o.data.splice(r[1], 1, n.data[(r[1] + 1) % 4]),
                    o.closeRing(),
                    new ol.geom.Polygon([o.data]);
                case 3:
                case 4:
                default:
                    ol.geom.Polygon.fromExtent(t)
                }
            },
            initMapEvents: function(t) {
                function e(t) {
                    return function(e) {
                        if (e.dragging)
                            return !0;
                        if ("moveend" == e.type) {
                            var i = e.map.getView().getCenter()
                              , n = s.wrapProjection(i);
                            if (i[0] < n[0] - 10 || i[0] > n[0] + 10)
                                return debug().warn("监测到地图离开世界范围，尝试修正", i, n),
                                n[0] == Number.NaN || n[1] == Number.NaN ? e.map.getView().setCenter(s.fromLonLat([119, 26])) : e.map.getView().setCenter(n),
                                !1
                        }
                        for (var r = e.map.getLayers().getArray().sort((function(t, e) {
                            return t.get("zIndex") - e.get("zIndex")
                        }
                        )), o = r.length - 1; o >= 0; o--) {
                            var a = r[o];
                            if (a[t] && (a._map || (a._map = e.map),
                            !1 === a[t](e)))
                                return !1
                        }
                    }
                }
                t.on("moveend", e("reset")),
                t.on("pointermove", e("onMousemove")),
                t.on("pointerdrag", e("onDragging")),
                t.on("singleclick", e("onClick"))
            },
            transformExtentToPixel: function(t, e) {
                var i = t.getPixelFromCoordinate([e[0], e[1]])
                  , n = t.getPixelFromCoordinate([e[2], e[3]]);
                return [i[0], n[1], n[0], i[1]]
            },
            transformExtentFromPixel: function(t, e) {
                var i = t.getCoordinateFromPixel([e[0], e[1]])
                  , n = t.getCoordinateFromPixel([e[2], e[3]]);
                return [i[0], n[1], n[0], i[1]]
            },
            addExtent: function(t, e) {
                return 2 == e.length ? [t[0] - e[0], t[1] - e[1], t[2] + e[0], t[3] + e[1]] : [t[0] + e[0], t[1] + e[1], t[2] + e[2], t[3] + e[3]]
            },
            translateExtent: function(t, e) {
                return [t[0] + e[0], t[1] + e[1], t[2] + e[0], t[3] + e[1]]
            },
            calcLabel: function(t, e, i, n, r, o) {
                var s = t._ctx;
                s.save(),
                e.font && (s.font = e.font);
                var a = s.measureText(n).width + 2 * e.labelOutSize;
                return s.restore(),
                ShipUtils.askLabelSpace(i, a, e.labelHeight + 2 * e.labelOutSize, t._map.labels, r || 20, !0, o || 20)
            },
            fromLonLat: function(t) {
                return ol.proj.fromLonLat(t)
            },
            toLonLat: function(t) {
                return ol.proj.toLonLat(t)
            },
            fromLonLats: function(t) {
                for (var e = [], i = 0; i < t.length; i++)
                    e[i] = this.fromLonLat(t[i]);
                return e
            },
            toLonLats: function(t) {
                for (var e = [], i = 0; i < t.length; i++)
                    e[i] = this.toLonLat(t[i]);
                return e
            },
            cjLayer: function() {
                var t = ol.proj.get("EPSG:4326")
                  , e = new ol.tilegrid.TileGrid({
                    tileSize: 256,
                    origin: [-400, 400],
                    extent: [103.87588002846373, 27.45228966609097, 121.40686460052386, 33.24664597260153],
                    resolutions: [.023794610058302804, .00951784402332112, .00475892201166056, .00237946100583028, .00118973050291514, .00059486525145757, .000297432625728785, .0001487163128643925, 7435815643219625e-20, 37179078216098126e-21, 1859072883855198e-20, 9294174688773075e-21, 4647087344386537e-21, 237946100583028e-20]
                })
                  , i = new ol.source.XYZ({
                    tileGrid: e,
                    projection: t,
                    url: "http://g3.ships66.com/maps/cjenc?z={z}&x={y}&y={x}&vali=false",
                    name: "cj"
                });
                return [new ol.layer.Tile({
                    source: i,
                    minZoom: 9,
                    name: "cjtype"
                })]
            },
            extentToWKT: function(t, e, i) {
                var n = new ol.geom.Polygon(t.data);
                if (i) {
                    var r = ol.geom.MultiPolygon();
                    e.bbox = format.writeGeometry(r)
                } else
                    e.bbox = format.writeGeometry(n);
                return delete e.vertices,
                e
            },
            flyTo: function(t, e, i) {
                var n = extend({}, {
                    per_duration: 300,
                    callback: function(t, e, i) {
                        debug().log("飞行结束...", t, e, i)
                    }
                }, i)
                  , r = e;
                if (e.getType)
                    switch (e.getType()) {
                    case "Point":
                        r = e.getCoordinates();
                        break;
                    default:
                        r = e.getCenter()
                    }
                var o = ol.sphere.getDistance(s.toLonLat(t.getView().getCenter()), s.toLonLat(r), 6378137) / t.getView().getResolution() / 256
                  , a = 1;
                o > 4 && (a = 3);
                for (var l = t.getView().getMinZoom(), h = t.getView().getZoom(), c = 0, g = 0; h - g >= l; g++)
                    if (Math.pow(2, g + l) > o) {
                        c = g;
                        break
                    }
                if (3 == a) {
                    var u = extend(n, {
                        duration: n.per_duration * c,
                        zoom: h - c
                    });
                    t.getView().animate(u, (function() {
                        var i = extend(n, {
                            duration: n.per_duration * (o / Math.pow(2, c)),
                            center: r
                        });
                        t.getView().animate(i, (function() {
                            var i = extend(n, {
                                duration: n.per_duration * c
                            });
                            t.getView().fit(e, i)
                        }
                        ))
                    }
                    ))
                } else
                    n.duration = n.per_duration * o,
                    debug().log("水平飞行,飞行时间为", n.duration),
                    t.getView().fit(e, n)
            },
            getGeoLocation: function(t, e) {
                var i = function(e) {
                    switch (e.code) {
                    case e.TIMEOUT:
                        (new debug).error("A timeout occured! Please try again!");
                        break;
                    case e.POSITION_UNAVAILABLE:
                        (new debug).error("We can't detect your location. Sorry!");
                        break;
                    case e.PERMISSION_DENIED:
                        (new debug).error("Please allow geolocation access for this to work.");
                        break;
                    default:
                        (new debug).error("An unknown error occured!", e)
                    }
                    t && t(e)
                }
                  , n = function(e) {
                    null == e && (new debug).error("定位功能只支持在https下访问，请访问https地址或做https支持！"),
                    t && t(e)
                };
            },
            showCityInfo: function(t, e) {
                s.getGeoLocation((function(e) {
                    var i = t.getView().getZoom();
                    if (i = i >= 10 ? i : 10,
                    1 == e.code) {
                        (new AMap.CitySearch).getLocalCity((function(e, n) {
                            if ("complete" === e && "OK" === n.info && n && n.city && n.bounds) {
                                var r = n.city
                                  , o = n.bounds;
                                return debug().log(r, o.getCenter()),
                                t.getView().setCenter(s.fromLonLat([o.getCenter().lng, o.getCenter().lat])),
                                t.getView().setZoom(i),
                                s.fromLonLat([o.getCenter().lng, o.getCenter().lat])
                            }
                        }
                        ))
                    } else {
                        if (null != e.coords && null != e.coords.longitude && null != e.coords.latitude)
                            return t.getView().setCenter(s.fromLonLat([e.coords.longitude, e.coords.latitude])),
                            t.getView().setZoom(i),
                            s.fromLonLat([e.coords.longitude, e.coords.latitude]);
                        (new debug).warn("定位失败", e)
                    }
                }
                ), {
                    keepWatch: e
                })
            }
        };
        t.ships = s,
        s.idle = new Idle
    }()
}

]);
